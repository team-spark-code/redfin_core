<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Member List</title>
    <style>
        .search-container {
            margin-bottom: 20px;
            text-align: center;
        }
        .search-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px;
            font-size: 14px;
        }
        .search-btn {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 8px;
        }
        .search-btn:hover {
            background: #0056b3;
        }
        .sync-btn {
            padding: 6px 12px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 8px;
        }
        .sync-btn:hover {
            background: #1e7e34;
        }
        .clear-btn {
            padding: 6px 12px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 4px;
        }
        .clear-btn:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
<div style="max-width:800px;margin:40px auto;padding:24px;border:1px solid #eee;border-radius:8px;box-shadow:0 2px 8px #eee;">
<h2 style="text-align:center;">íšŒì› ëª©ë¡</h2>

<!-- ê²€ìƒ‰ í¼ -->
<div class="search-container">
    <form method="get" action="/members">
        <div style="margin-bottom: 10px;">
            <input type="text" name="keyword" class="search-input"
                   th:value="${keyword}" placeholder="ì´ë¦„, ì•„ì´ë””, ì´ë©”ì¼, ì£¼ì†Œë¡œ ê²€ìƒ‰...">
            <button type="submit" class="search-btn">ê²€ìƒ‰</button>
            <a href="/members" class="clear-btn" style="text-decoration:none;display:inline-block;">ì „ì²´ë³´ê¸°</a>
            <button type="button" class="sync-btn" onclick="syncToElasticsearch()">ES ë™ê¸°í™”</button>
        </div>

        <!-- ê²€ìƒ‰ ëª¨ë“œ ì„ íƒ -->
        <div style="margin-bottom: 10px;">
            <label style="font-size: 12px; color: #666;">ê²€ìƒ‰ ëª¨ë“œ:</label>
            <select name="searchMode" style="padding: 4px 8px; font-size: 12px; border: 1px solid #ddd; border-radius: 3px; margin-left: 5px;">
                <option value="standard" th:selected="${searchMode == 'standard'}">í‘œì¤€ ê²€ìƒ‰ (ì—°ê´€ë„ ê¸°ë°˜)</option>
                <option value="exact" th:selected="${searchMode == 'exact'}">ì •í™•í•œ ë§¤ì¹­ (ë†’ì€ ì •í™•ë„)</option>
                <option value="fuzzy" th:selected="${searchMode == 'fuzzy'}">ìœ ì‚¬ ê²€ìƒ‰ (ì˜¤íƒ€ í—ˆìš©)</option>
            </select>
            <span style="font-size: 11px; color: #999; margin-left: 10px;">
                ğŸ’¡ í‘œì¤€: ì—°ê´€ë„ìˆœ ì •ë ¬ | ì •í™•: ì™„ì „ì¼ì¹˜ ìš°ì„  | ìœ ì‚¬: ì˜¤íƒ€ í—ˆìš©
            </span>
        </div>
    </form>

    <div th:if="${keyword != null and !#strings.isEmpty(keyword)}" style="margin-top:8px;font-size:14px;color:#666;">
        ê²€ìƒ‰ì–´: "<span th:text="${keyword}"></span>"
        <span th:if="${searchMode != null and searchMode != 'standard'}" style="color: #007bff;">
            (ëª¨ë“œ: <span th:text="${searchMode == 'exact' ? 'ì •í™•í•œ ë§¤ì¹­' : (searchMode == 'fuzzy' ? 'ìœ ì‚¬ ê²€ìƒ‰' : 'í‘œì¤€ ê²€ìƒ‰')}"></span>)
        </span>
    </div>
</div>

<table style="width:100%;border-collapse:collapse;margin-bottom:16px;">
    <thead>
    <tr style="background:#f8f8f8;">
        <th style="padding:8px;border-bottom:1px solid #ddd;">ID</th>
        <th style="padding:8px;border-bottom:1px solid #ddd;">ì•„ì´ë””</th>
        <th style="padding:8px;border-bottom:1px solid #ddd;">ì´ë¦„</th>
        <th style="padding:8px;border-bottom:1px solid #ddd;">ì´ë©”ì¼</th>
        <th style="padding:8px;border-bottom:1px solid #ddd;">ì£¼ì†Œ</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="member : ${members}">
        <td th:text="${member.id}" style="padding:8px;border-bottom:1px solid #eee;"></td>
        <td th:text="${member.username}" style="padding:8px;border-bottom:1px solid #eee;"></td>
        <td th:text="${member.name}" style="padding:8px;border-bottom:1px solid #eee;"></td>
        <td th:text="${member.email}" style="padding:8px;border-bottom:1px solid #eee;"></td>
        <td th:text="${member.address}" style="padding:8px;border-bottom:1px solid #eee;"></td>
    </tr>
    </tbody>
</table>

<!-- ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì„ ë•Œ -->
<div th:if="${#lists.isEmpty(members)}" style="text-align:center;padding:20px;color:#666;">
    <div th:if="${keyword != null and !#strings.isEmpty(keyword)}">
        ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
    </div>
    <div th:unless="${keyword != null and !#strings.isEmpty(keyword)}">
        ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.
    </div>
</div>

<!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
<div style="text-align:center;margin-bottom:12px;" th:if="${!#lists.isEmpty(members)}">
    <span th:if="${hasPrev}">
        <a th:href="@{'/members'(page=${currentPage - 1}, keyword=${keyword})}" style="margin:0 8px;">ì´ì „</a>
    </span>
    <span> Page <span th:text="${currentPage + 1}"></span> / <span th:text="${totalPages}"></span> </span>
    <span th:if="${hasNext}">
        <a th:href="@{'/members'(page=${currentPage + 1}, keyword=${keyword})}" style="margin:0 8px;">ë‹¤ìŒ</a>
    </span>
</div>

<p style="text-align:center;"><a href="/">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a></p>
</div>

<script>
function syncToElasticsearch() {
    if (!confirm('ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ì— íšŒì› ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
    }

    fetch('/members/sync', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            alert(data.message);
        } else {
            alert('ì˜¤ë¥˜: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

// ì—”í„°í‚¤ë¡œ ê²€ìƒ‰ ì‹¤í–‰
document.querySelector('.search-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        e.target.closest('form').submit();
    }
});
</script>
</body>
</html>
